name: CI
on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v5
    
    - name: Validate stencil files
      run: |
        echo "üé® Validating VMware stencil files..."
        
        # Check if required directories exist
        if [ ! -d "stencils" ]; then
          echo "‚ùå Missing stencils/ directory"
          exit 1
        fi
        
        if [ ! -d "icons" ]; then
          echo "‚ùå Missing icons/ directory"
          exit 1
        fi
        
        if [ ! -d "omnigraffle" ]; then
          echo "‚ùå Missing omnigraffle/ directory"
          exit 1
        fi
        
        # Check if ZIP file exists
        if [ ! -f "VMware-Stencils-2024.zip" ]; then
          echo "‚ùå Missing VMware-Stencils-2024.zip"
          exit 1
        fi
        
        # Count files
        STENCIL_COUNT=$(find stencils/ -name "*.vssx" -o -name "*.vstm" | wc -l)
        ICON_COUNT=$(find icons/ -name "*.svg" | wc -l)
        OMNI_COUNT=$(find omnigraffle/ -name "*.gstencil" -o -name "*.clr" | wc -l)
        
        echo "‚úÖ Found $STENCIL_COUNT Visio stencil files"
        echo "‚úÖ Found $ICON_COUNT SVG icon files"
        echo "‚úÖ Found $OMNI_COUNT OmniGraffle files"
        
        # Basic SVG validation (check for SVG tags)
        echo "üîç Validating SVG file structure..."
        INVALID_SVG=0
        for svg in icons/*.svg; do
          if ! grep -q "<svg" "$svg" || ! grep -q "</svg>" "$svg"; then
            echo "‚ùå Invalid SVG structure: $svg"
            INVALID_SVG=$((INVALID_SVG + 1))
          fi
        done
        
        if [ $INVALID_SVG -eq 0 ]; then
          echo "‚úÖ All SVG files have valid structure"
        else
          echo "‚ùå Found $INVALID_SVG SVG files with invalid structure"
          exit 1
        fi
        
        echo "üéâ Stencil collection validation completed successfully!"