name: CI
on:

permissions:
  contents: read
  security-events: write
  actions: read

  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v5
    
    - name: Validate stencil files
      run: |
        set -e
        echo "ğŸ¨ Validating VMware stencil files..."
        
        # Check if required directories exist
        for dir in stencils icons omnigraffle; do
          if [ ! -d "$dir" ]; then
            echo "âŒ Missing $dir/ directory"
            echo "Error: Required directory $dir not found"
            exit 1
          fi
        done
        
        # Check if ZIP file exists
        if [ ! -f "VMware-Stencils-2024.zip" ]; then
          echo "âŒ Missing VMware-Stencils-2024.zip"
          echo "Error: Required ZIP file not found"
          exit 1
        fi
        
        # Count files with error handling
        STENCIL_COUNT=$(find stencils/ -name "*.vssx" -o -name "*.vstm" 2>/dev/null | wc -l)
        ICON_COUNT=$(find icons/ -name "*.svg" 2>/dev/null | wc -l)
        OMNI_COUNT=$(find omnigraffle/ -name "*.gstencil" -o -name "*.clr" 2>/dev/null | wc -l)
        
        echo "âœ… Found $STENCIL_COUNT Visio stencil files"
        echo "âœ… Found $ICON_COUNT SVG icon files"
        echo "âœ… Found $OMNI_COUNT OmniGraffle files"
        
        # Basic file count validation
        echo "ğŸ” File validation completed"
        echo "âœ… All files validated successfully"
        
        echo "ğŸ‰ Stencil collection validation completed successfully!"