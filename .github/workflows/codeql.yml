name: "Security Scan"

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
  schedule:
    - cron: '0 6 * * 1'

jobs:
  security:
    name: Security Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Security validation
      run: |
        echo "ðŸ” Running security validation for stencil files..."
        
        # Check for suspicious files
        if find . -name "*.exe" -o -name "*.bat" -o -name "*.ps1" | grep -q .; then
          echo "âš ï¸ Found potentially suspicious executable files"
          find . -name "*.exe" -o -name "*.bat" -o -name "*.ps1"
        else
          echo "âœ… No suspicious executable files found"
        fi
        
        # Validate file sizes (prevent large malicious files)
        LARGE_FILES=$(find . -size +10M -type f)
        if [ -n "$LARGE_FILES" ]; then
          echo "âš ï¸ Found large files (>10MB):"
          echo "$LARGE_FILES"
        else
          echo "âœ… All files are reasonable size"
        fi
        
        # Check stencil file integrity
        echo "ðŸ“Š Stencil file summary:"
        echo "  Visio files: $(find stencils/ -name '*.vssx' -o -name '*.vstm' | wc -l)"
        echo "  SVG icons: $(find icons/ -name '*.svg' | wc -l)"
        echo "  OmniGraffle files: $(find omnigraffle/ -name '*.gstencil' -o -name '*.clr' | wc -l)"
        
        echo "âœ… Security validation completed"